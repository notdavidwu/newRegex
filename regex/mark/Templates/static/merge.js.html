<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/highlight-within-textarea@2.0.5/jquery.highlight-within-textarea.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/highlight-within-textarea@2.0.5/jquery.highlight-within-textarea.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.css">
<script src="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.js"></script>
<script>    
    $(document).ready(function () {

        //根據select顯示token
        $("#twoOrThree").on('change', function() {
            value = document.getElementById('twoOrThree').value;
            if (value === "2"){                
                printAllData();
            }
            else if (value === "3"){
                printAllData_3();
            }
        });

        //根據filter顯示token
        $("#filter").on('change', function() {
            value = document.getElementById('twoOrThree').value;
            if (value === "2"){                
                printAllData();
            }
            else if (value === "3"){
                printAllData_3();
            }
        });

        //顯示資料
        printAllData();

        //顯示P資料
        printAllPData();
        
    });

    //顯示資料
    function printAllData(){
        response = getTextTokenData();
        console.log("response.data : ", response.data);

        //處理成tokenID1[].tokenID2[]
        tokenID = seperateArray(response.data);
        //console.log(tokenID);

        //顯示結果表格
        if (tokenID){
            let headers = ['No','First', 'Second', 'Times', 'MergeCheck'];
            var array = [];
            var temp = [];

            //if (xxx.value === 2){
                for(var i=0 ; i<tokenID[0].length ; i++){
                    array.push([i+1, tokenID[0][i], tokenID[1][i], tokenID[2][i]])
                }
            //}
            //else if (xxx.value === 3){
            //    for(var i=0 ; i<tokenID[0].length ; i++){
            //        array.push([i+1, tokenID[0][i], tokenID[1][i], tokenID[2][i], tokenID[3][i]])
            //    }
            //}
            console.log("array = ", array);
            showTable(headers, array, tokenID);
        }
    }

    //顯示資料
    function printAllData_3(){
        response = getTextTokenData_3();
        console.log("response.data : ", response.data);

        //處理成tokenID1[].tokenID2[]
        tokenID = seperateArray_3(response.data);
        //console.log(tokenID);

        //顯示結果表格
        if (tokenID){
            let headers = ['No','First', 'Second', 'Times', 'MergeCheck'];
            var array = [];
            var temp = [];

            //if (xxx.value === 2){
                for(var i=0 ; i<tokenID[0].length ; i++){
                    array.push([i+1, tokenID[0][i], tokenID[1][i], tokenID[2][i], tokenID[3][i]])
                }
            //}
            //else if (xxx.value === 3){
            //    for(var i=0 ; i<tokenID[0].length ; i++){
            //        array.push([i+1, tokenID[0][i], tokenID[1][i], tokenID[2][i], tokenID[3][i]])
            //    }
            //}
            console.log("array = ", array);
            showTable_3(headers, array, tokenID);
        }
    }

    //顯示P資料
    function printAllPData(){
        response = getVocabularyData();
        var tokenP = response.data;
        console.log("response.data : ", response.data);
//
        ////處理成tokenID1[].tokenID2[]
        //tokenID = seperateArray(response.data);
        ////console.log(tokenID);
//
        ////顯示結果表格
        if (tokenP != []){
            let headers = ['No','ProperNoun'];
            var array = [];
            var temp = [];

            //if (xxx.value === 2){
            for(var i=0 ; i<tokenP.length ; i++){
                array.push([i+1, tokenP[i].token, tokenP[i].tokenType])
            }
            //}
            //else if (xxx.value === 3){
            //    for(var i=0 ; i<tokenID[0].length ; i++){
            //        array.push([i+1, tokenID[0][i], tokenID[1][i], tokenID[2][i], tokenID[3][i]])
            //    }
            //}
            console.log("array = ", array);
            showTableP(headers, array, tokenID);
        }
    }
    
    //取得P資料
    function getVocabularyData(){
        var res;
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'getVocabularyByType' %}',
            data:{
                "tokenType" : "P",
            },
            success:function (response){
                res = response;
                //console.log("res : ", res);
            },
        });
        return res;
    }

    //取得所有資料
    function getTextTokenData(){
        var res;
        var NS = document.getElementById("filter").value;
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'getTextToken' %}',
            data:{
                "NoSign" : NS,
            },
            success:function (response){
                res = response;
                //console.log("res : ", res);
            },
        });
        return res;
    }
    
    //取得所有資料
    function getTextTokenData_3(){
        var res;
        var NS = document.getElementById("filter").value;
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'getTextToken_3' %}',
            data:{
                "NoSign" : NS,
            },
            success:function (response){
                res = response;
                //console.log("res : ", res);
            },
        });
        return res;
    }

    //處理成tokenID1[].tokenID2[]
    function seperateArray(data){
        var res = [];
        var firstTokenID = [];
        var secondTokenID = [];
        var times = [];
        data.forEach(function(a){
            //console.log(a.tokenID1, a.tokenID2);
            firstTokenID.push(a.token1);
            secondTokenID.push(a.token2);
            times.push(a.times);
        });
        res.push(firstTokenID);
        res.push(secondTokenID);
        res.push(times);
        console.log(res);
        return res;
    }

    //處理成tokenID1[].tokenID2[].tokenID3[]
    function seperateArray_3(data){
        var res = [];
        var firstTokenID = [];
        var secondTokenID = [];
        var thirdTokenID = [];
        var times = [];
        data.forEach(function(a){
            //console.log(a.tokenID1, a.tokenID2);
            firstTokenID.push(a.token1);
            secondTokenID.push(a.token2);
            thirdTokenID.push(a.token3);
            times.push(a.times);
        });
        res.push(firstTokenID);
        res.push(secondTokenID);
        res.push(thirdTokenID);
        res.push(times);
        //console.log(res);
        return res;
    }

    //取出字典的字
    function getDictionary(tokenID){
        var res = [];
        var tokenID1 = tokenID[0];
        var tokenID2 = tokenID[1];
        $.ajax({
            async: false,
            type: 'POST',
            url: '{% url 'getToken' %}',
            data:{
                "tokenID1[]" : tokenID1,
                "tokenID2[]" : tokenID2,
            },
            success:function (response){
                res.push(response.data[0].token1);
                res.push(response.data[0].token2);
                //console.log("res : ", res);
            },
        });
        return res;
    }

    //顯示結果表格
    function showTable(headers, array, tokenID){
        console.log("array : ",array);
        let object=`<table class="table table-striped-columns">
            <thead style="user-select:none;">
                <tr>
                    <td>No</td>
                    <td>First</td>
                    <td>Second</td>
                    <td>Times</td>
                    <td>MergeCheck</td>
                </tr>
            </thead>
            <tbody>`
        for(let i=0;i<array.length;i++){
            object += `<tr>
                <td class='No' value="${array[i][0]}" style="user-select:none;">${array[i][0]}</td>
                <td class='First' value="${array[i][1]}" >${array[i][1]}</td>
                <td class='Second' value="${array[i][2]}" >${array[i][2]}</td>
                <td class='Times' value="${array[i][3]}" style="user-select:none;">${array[i][3]}</td>
                <td class='Mergecheck' ><button onclick="merge()" class="btn btn-info">Merge</button></td>
            </tr>`
        }
        object +='</tbody></table>'
        $('#result_data').empty();
        $('#result_data').append(object);
    }

    //顯示結果表格
    function showTable_3(headers, array, tokenID){
        console.log("array : ",array);
        let object=`<table class="table table-striped-columns">
            <thead>
                <tr>
                    <td>No</td>
                    <td>First</td>
                    <td>Second</td>
                    <td>Third</td>
                    <td>Times</td>
                    <td>MergeCheck</td>
                </tr>
            </thead>
            <tbody>`
        for(let i=0;i<array.length;i++){
            object += `<tr>
                <td class='No' value="${array[i][0]}" style="user-select:none;">${array[i][0]}</td>
                <td class='First' value="${array[i][1]}" >${array[i][1]}</td>
                <td class='Second' value="${array[i][2]}" >${array[i][2]}</td>
                <td class='Third' value="${array[i][3]}" >${array[i][3]}</td>
                <td class='Times' value="${array[i][4]}" style="user-select:none;">${array[i][4]}</td>
                <td class='Mergecheck' ><button onclick="merge_3()" class="btn btn-info">Merge</button></td>
            </tr>`
        }
        object +='</tbody></table>'
        $('#result_data').empty();
        $('#result_data').append(object);
    }

    //顯示結果表格P
    function showTableP(headers, array, tokenID){
        console.log("array : ",array);
        let object=`<table class="table table-striped-columns">
            <thead style="user-select:none;">
                <tr>
                    <td>No</td>
                    <td>Token</td>
                    <td>TokenType</td>
                    <td>AddRE</td>
                    <td>Undo</td>
                </tr>
            </thead>
            <tbody>`
        PNarray = checkPN(array);
        for(let i=0;i<array.length;i++){
            if (PNarray[i] === 0){
                object += `<tr>
                    <td class='No' value="${array[i][0]}" style="user-select:none;">${array[i][0]}</td>
                    <td class='ProperNoun' value="${array[i][1]}" >${array[i][1]}</td>
                    <td class='tokenType' value="${array[i][2]}" >${array[i][2]}</td>
                    <td class='NewRE' ><button onclick="changeSrc()" class="btn btn-secondary">NewRE</button></td>
                    <td class='UnMerge' ><button onclick="" class="btn btn-danger">UnMerge</button></td>
                </tr>`
            }
            else if(PNarray[i] === 1){
                object += `<tr>
                    <td class='No' value="${array[i][0]}" style="user-select:none;">${array[i][0]}</td>
                    <td class='ProperNoun' value="${array[i][1]}" >${array[i][1]}</td>
                    <td class='tokenType' value="${array[i][2]}" >${array[i][2]}</td>
                    <td class='Merged' value="Merged" style="user-select:none;">Merged</td>
                    <td class='Merged' value="Merged" style="user-select:none;">Merged</td>
                </tr>`
            }
            else if(PNarray[i] === 2){
                object += `<tr>
                    <td class='No' value="${array[i][0]}" style="user-select:none;">${array[i][0]}</td>
                    <td class='ProperNoun' value="${array[i][1]}" >${array[i][1]}</td>
                    <td class='tokenType' value="${array[i][2]}" >${array[i][2]}</td>
                    <td class='NewRE' ><button onclick="changeSrc()" class="btn btn-secondary">NewRE</button></td>
                    <td class='Basic' value="Basic" style="user-select:none;"></td>
                </tr>`
            }
        }
        object +='</tbody></table>'
        $('#result_dataP').empty();
        $('#result_dataP').append(object);
    }

    function merge(){
        $(event.target).toggleClass('active');
        if ($(event.target).attr('class') == "btn btn-info active" ){
            let token1 = $(event.target).parents('tr').find('.First')[0].getAttribute('value');
            console.log("token1 = ", token1);
            let token2 = $(event.target).parents('tr').find('.Second')[0].getAttribute('value');
            console.log("token2 = ", token2);
            let times = $(event.target).parents('tr').find('.Times')[0].getAttribute('value');
            console.log("times = ", times);
            var Token = token1 + token2;
            var lenOfToken = Token.length;
            var TokenType = document.getElementById("selectTokenType").value;
            console.log(Token, lenOfToken, TokenType);
            
            if (TokenType){
                //存新的volcabulary(a+b)
                response = insertVocabulary_new(Token, lenOfToken, TokenType);
                if(response.status === '0'){
                    console.log("tokenID : ", response.data[0].tokenID);
                    newTokenID = response.data[0].tokenID;
                    //取得被合併的兩個tokenID
                    tokenIDArray = getTokenIDByName([token1,token2]);
                    console.log("tokenIDArray : ", tokenIDArray);
                    if (tokenIDArray.status === "0"){
                        console.log("in");
                        //取得textToken位置
                        positionArray = getPositionOfTextToken(tokenIDArray.tokenID);
                        console.log("positionArray : ", positionArray);
                        if (positionArray.status === "0"){
                            //將textToken原始資料*(-1)
                            response = multiplyByMinusOne(tokenIDArray.tokenID);
                            if (response.status === "0"){
                                //存入新的tokenID到textToken
                                response = insertNewTextToken(positionArray, newTokenID);
                                if (response.status === "0"){
                                    printAllData();
                                }                            
                            }
                        }
                    }
                }
                else if (response.status === 'already_exist'){
                    console.log("already_exist!!!");
                    display_already_exist();
                }
            }
            else{
                console.log("choose a token type");
                display_noInput();
            }
            //console.log("class : ", $(event.target).attr('class'));
        }
        else{            
            //console.log("class : ", $(event.target).attr('class'));
        }            
    }

    function merge_3(){
        $(event.target).toggleClass('active');
        if ($(event.target).attr('class') == "btn btn-info active" ){
            let token1 = $(event.target).parents('tr').find('.First')[0].getAttribute('value');
            console.log("token1 = ", token1);
            let token2 = $(event.target).parents('tr').find('.Second')[0].getAttribute('value');
            console.log("token2 = ", token2);
            let token3 = $(event.target).parents('tr').find('.Third')[0].getAttribute('value');
            console.log("token3 = ", token3);
            let times = $(event.target).parents('tr').find('.Times')[0].getAttribute('value');
            console.log("times = ", times);
            var Token = token1 + token2 + token3;
            var lenOfToken = Token.length;
            var TokenType = document.getElementById("selectTokenType").value;
            console.log(Token, lenOfToken, TokenType);
            
            if (TokenType){
                //存新的volcabulary(a+b+c)
                response_new = insertVocabulary_new(Token, lenOfToken, TokenType);
                console.log("stauts : ", response_new);
                if(response.status === '0'){
                    console.log("tokenID : ", response.data[0].tokenID);
                    newTokenID = response.data[0].tokenID;
                    //取得被合併的兩個tokenID
                    tokenIDArray = getTokenIDByName([token1, token2, token3]);
                    console.log("tokenIDArray : ", tokenIDArray);
                    if (tokenIDArray.status === "0"){
                        console.log("in");
                        //取得textToken位置
                        positionArray = getPositionOfTextToken_3(tokenIDArray.tokenID);
                        console.log("positionArray : ", positionArray);
                        if (positionArray.status === "0"){
                            //將textToken原始資料*(-1)
                            response1 = multiplyByMinusOne_3(tokenIDArray.tokenID);
                            if (response1.status === "0"){
                                //console.log("minus one response : ", response)
                                //存入新的tokenID到textToken
                                response1 = insertNewTextToken(positionArray, newTokenID);
                                if (response1.status === "0"){
                                    printAllData();
                                }
                            }
                        }
                    }
                }
                else if (response.status === 'already_exist'){
                    console.log("already_exist!!!");
                    display_already_exist();
                }
            }
            else{
                console.log("choose a token type");
                display_noInput();
            }
            //console.log("class : ", $(event.target).attr('class'));
        }
        else{            
            //console.log("class : ", $(event.target).attr('class'));
        }            
    }

    //顯示未輸入
    function display_noInput(){
        var x = document.getElementById("noInput");
        //console.log(x.style.visibility)
        if (document.getElementById("noInput").style.visibility != 'visible') {
            document.getElementById("noInput").style.visibility = 'visible';
            setTimeout(function() {
                //your code to be executed after 1 second                    
                document.getElementById("noInput").style.visibility = 'hidden';
            }, 1200);
        }
    }

    //顯示已經存在
    function display_already_exist(){
        var x = document.getElementById("already_exist");
        //console.log(x.style.visibility)
        if (document.getElementById("already_exist").style.visibility != 'visible') {
            document.getElementById("already_exist").style.visibility = 'visible';
            setTimeout(function() {
                //your code to be executed after 1 second                    
                document.getElementById("already_exist").style.visibility = 'hidden';
            }, 1200);
        }
    }

    //存新的volcabulary(a+b)
    function insertVocabulary_new(token, nWord, tokenType){
        console.log("insertVocabulary_new : ", token, nWord, tokenType);
        var res = [];
        $.ajax({
            async: false,
            type: 'POST',
            url: '{% url 'insertVocabulary' %}',
            data:{
                "token" : token,
                "nWord" : nWord,
                "tokenType" : tokenType,
            },
            success:function (response){
                res = response;
                console.log("res : ", res);
            },
        });
        return res;
    }
    
    //取得被合併的兩個tokenID
    function getTokenIDByName(Name){
        var res = [];
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'checkName' %}',
            data:{
                "Name[]" : Name,
            },
            success:function (response){
                res = response;
                //console.log("res : ", res);
            },
        });
        return res;
    }
    
    //取得textToken位置
    function getPositionOfTextToken(tokenIDArray){
        console.log("tokenIDArray : ", tokenIDArray);
        var res = [];
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'insertTexttoken' %}',
            data:{
                "tokenID1" : tokenIDArray[0],
                "tokenID2" : tokenIDArray[1],
            },
            success:function (response){
                res = response;
                //console.log("res : ", res);
            },
        });
        return res;
    }

    //取得textToken位置
    function getPositionOfTextToken_3(tokenIDArray){
        console.log("tokenIDArray : ", tokenIDArray);
        var res = [];
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'insertTexttoken_3' %}',
            data:{
                "tokenID1" : tokenIDArray[0],
                "tokenID2" : tokenIDArray[1],
                "tokenID3" : tokenIDArray[2],
            },
            success:function (response){
                res = response;
                console.log("res : ", res);
            },
        });
        return res;
    }

    //將textToken原始資料*(-1)
    function multiplyByMinusOne(tokenIDArray){
        var res = [];
        $.ajax({
            async: false,
            type: 'PATCH',
            url: '{% url 'getTextToken' %}',
            data:JSON.stringify({
                "tokenID1" : tokenIDArray[0],
                "tokenID2" : tokenIDArray[1],
            }),
            success:function (response){
                res = response;
                console.log("res : ", res);
            },
        });
        return res;
    }

    //將textToken原始資料*(-1)
    function multiplyByMinusOne_3(tokenIDArray){
        console.log("tokenIDArray_3 : ", tokenIDArray);
        var res = [];
        $.ajax({
            async: false,
            type: 'PATCH',
            url: '{% url 'getTextToken_3' %}',
            data:JSON.stringify({
                "tokenID1" : tokenIDArray[0],
                "tokenID2" : tokenIDArray[1],
                "tokenID3" : tokenIDArray[2],
            }),
            success:function (response){
                res = response;
                console.log("res : ", res);
            },
        });
        return res;
    }

    //存入新的tokenID到textToken
    function insertNewTextToken(positionArray, newTokenID){
        console.log("positionArray : ", positionArray.data);
        console.log("newTokenID : ", newTokenID);
        var res = [];
        $.ajax({
            async: false,
            type: 'POST',
            url: '{% url 'insertTexttoken' %}',
            data:JSON.stringify({
                "positionArray[]" : positionArray.data,
                "newTokenID" : newTokenID,
            }),
            contentType: 'application/json',
            dataType: 'json',
            success:function (response){
                res = response;
                console.log("res : ", res);
            },
        });
        return res;
    }

    //取得是否為最後一代
    function checkPN(array){
        tokenArray = [];
        for (var i=0 ; i<array.length ; i++){
            tokenArray[i] = array[i][1];
        }
        console.log("checkPN : ", tokenArray);
        var res = [];
        $.ajax({
            async: false,
            type: 'POST',
            url: '{% url 'getTokenIDCheckTextToken' %}',
            data:{
                "token[]" : tokenArray,
            },
            success:function (response){
                res = response;
                console.log("PNarray : ", res.data);
            },
        });
        return res.data;
    }

    //全選
    function selectAllButton(){
        var AllBtn = document.getElementsByClassName("btn btn-info");
        len = AllBtn.length;
        for (var i=0 ; i<len ; i++ ){
            let targetNode = document.getElementById("button" + i.toString());
            if (!targetNode.classList.contains("active")){
                targetNode.click();
            //    targetNode.classList.add('active');
            }
        }
    }

    //取消
    function cancelAllButton(){
        var AllBtn = document.getElementsByClassName("btn btn-info")
        len = AllBtn.length;
        for (var i=0 ; i<len ; i++ ){
            let targetNode = document.getElementById("button" + i.toString());
            if (targetNode.classList.contains("active")){   
                targetNode.click();             
            //    targetNode.classList.remove('active');
            }
            if (targetNode.disabled === true){
                targetNode.disabled = false;
            }
        }
    }

    //確認前後重複+disable
    function checkDuplicateDisable(btn, tokenID, disableArray){
        //console.log(btn.value);
        //console.log(tokenID);
        var first = tokenID[0];
        var second = tokenID[1];
        var index = parseInt(btn.value);
        //先找到陣列值
        if (first[index]){
            tokenID1 = first[index];
            tokenID2 = second[index];
            console.log(tokenID1, tokenID2);
            //如果前一筆資料存在 且 後面的id跟現在前面的一樣 就disable按鈕
            if (second[index-1] && second[index-1] === first[index] ){
                console.log("前一個disable");
                disableBtn = document.getElementById("button" + (index-1).toString());
                //若他不是被選中的
                if (disableBtn.className === "btn btn-info active"){
                    console.log("選到前面選中的了");
                }
                else{
                    disableBtn.disabled = true;
                    
                    console.log("disableArray : ", disableArray);

                    if (disableArray[index] === 'undefined'){
                        disableArray[index] = [];
                        disableArray[index][0] = index;
                        disableArray[index][1] = index + 1;
                    }
                    else{  
                        disableArray[index][1] = index + 1;
                    }
                }
            }
            
            //如果後一筆資料存在 且 前面的id跟現在後面的一樣 就disable按鈕
            if (first[index+1] && first[index+1] === second[index] ){                
                console.log("後一個disable");
                disableBtn = document.getElementById("button" + (index+1).toString());
                //若他不是被選中的
                if (disableBtn.className === "btn btn-info active"){
                    console.log("選到後面選中的了");
                }
                else{
                    disableBtn.disabled = true;
                }
            }
        }
        console.log("disableArray : ", disableArray);
    }

    //確認前後重複+取消disable
    function checkDuplicateAble(btn, tokenID){
        //console.log(btn.value);
        //console.log(tokenID);
        var first = tokenID[0];
        var second = tokenID[1];
        var index = parseInt(btn.value);
        //先找到陣列值
        if (first[index]){
            tokenID1 = first[index];
            tokenID2 = second[index];
            console.log(tokenID1, tokenID2);
            //(如果前一筆資料存在 且 後面的id跟現在前面的一樣) 
            //且(前兩筆沒使用到)就disable按鈕
            if (second[index-1] && second[index-1] === first[index] ){
                console.log("前一個able");
                disableBtn = document.getElementById("button" + (index-1).toString());
                disableBtn.disabled = false;
            }
            
            //如果後一筆資料存在 且 前面的id跟現在後面的一樣 就disable按鈕
            if (first[index+1] && first[index+1] === second[index] ){                
                console.log("後一個able");
                disableBtn = document.getElementById("button" + (index+1).toString());
                disableBtn.disabled = false;
            }
        }
    }


    //開啟網頁傳值
    function changeSrc() {
        // Get the iframe element
        var iframe = document.getElementById("iframe");        
        var overlay = document.querySelector('.overlay');
        var iframeDoc = iframe.contentWindow.document;
        var feedbackElement = iframeDoc.querySelector('.warning-feedback');
        feedbackElement.textContent = "";
        console.log(" regexName : ", $("#regexName"));
        var drop = iframeDoc.getElementById("regexName");
        drop.classList.remove("is-warning");

        if(iframe.style.display == "block"){            
            iframe.style.display = "none";
            overlay.style.display = "none";
        }
        else{
            document.addEventListener("click", function(event) {
                // Check if the clicked element is inside the iframe or the button that opened the iframe
                if (event.target !== iframe && !event.target.classList.contains("btn")) {
                    // If it is not, hide the iframe
                    iframe.style.display = "none";                  
                    overlay.style.display = "none";
                }
            });
            
            overlay.style.display = "block";

            iframe.style.display = "block";
            
        
            var navbar = iframeDoc.getElementById("navbar");
            navbar.style.display = "none";
            
            var box = iframeDoc.getElementById("regexName");
            var drop = iframeDoc.getElementById("dropdownbutton");
            iframeDoc.getElementById("E").selected = true;

            
            var drop23 = document.getElementById("twoOrThree");
            let Token = $(event.target).parents('tr').find('.ProperNoun')[0].getAttribute('value');

            box.value = Token;
        }
    }
    
</script> 